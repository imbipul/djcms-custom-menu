/*!
 * Nestable jQuery Plugin - Copyright (c) 2014 Ramon Smit - https://github.com/RamonSmit/Nestable
 */
(function(f,c,a,h){var e="ontouchstart" in a;var d=(function(){var j=a.createElement("div"),k=a.documentElement;if(!("pointerEvents" in j.style)){return false}j.style.pointerEvents="auto";j.style.pointerEvents="x";k.appendChild(j);var i=c.getComputedStyle&&c.getComputedStyle(j,"").pointerEvents==="auto";k.removeChild(j);return !!i})();var g={contentCallback:function(i){return i.content||""?i.content:i.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:false,fixed:false,includeContent:false,scroll:false,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(i,k,j){},onDragStart:function(i,k,j){},beforeDragStop:function(i,k,j){},listRenderer:function(k,i){var j="<"+i.listNodeName+' class="'+i.listClass+'">';j+=k;j+="</"+i.listNodeName+">";return j},itemRenderer:function(j,o,m,k,n){var i=f.map(j,function(q,p){return" "+p+'="'+q+'"'}).join(" ");var l="<"+k.itemNodeName+i+">";l+="<"+k.handleNodeName+' class="'+k.handleClass+'">';l+="<"+k.contentNodeName+' class="'+k.contentClass+'">';l+=o;l+="</"+k.contentNodeName+">";l+="</"+k.handleNodeName+">";l+=m;l+="</"+k.itemNodeName+">";return l}};function b(j,i){this.w=f(a);this.el=f(j);i=i||g;if(i.rootClass!==h&&i.rootClass!=="dd"){i.listClass=i.listClass?i.listClass:i.rootClass+"-list";i.itemClass=i.itemClass?i.itemClass:i.rootClass+"-item";i.dragClass=i.dragClass?i.dragClass:i.rootClass+"-dragel";i.handleClass=i.handleClass?i.handleClass:i.rootClass+"-handle";i.collapsedClass=i.collapsedClass?i.collapsedClass:i.rootClass+"-collapsed";i.placeClass=i.placeClass?i.placeClass:i.rootClass+"-placeholder";i.noDragClass=i.noDragClass?i.noDragClass:i.rootClass+"-nodrag";i.noChildrenClass=i.noChildrenClass?i.noChildrenClass:i.rootClass+"-nochildren";i.emptyClass=i.emptyClass?i.emptyClass:i.rootClass+"-empty"}this.options=f.extend({},g,i);if(this.options.json!==h){this._build()}this.init()}b.prototype={init:function(){var n=this;n.reset();n.el.data("nestable-group",this.options.group);n.placeEl=f('<div class="'+n.options.placeClass+'"/>');var i=this.el.find(n.options.itemNodeName);f.each(i,function(o,q){var r=f(q),p=r.parent();n.setParent(r);if(p.hasClass(n.options.collapsedClass)){n.collapseItem(p.parent())}});if(!i.length){this.appendEmptyElement(this.el)}n.el.on("click","button",function(r){if(n.dragEl){return}var q=f(r.currentTarget),p=q.data("action"),o=q.parents(n.options.itemNodeName).eq(0);if(p==="collapse"){n.collapseItem(o)}if(p==="expand"){n.expandItem(o)}});var k=function(p){var o=f(p.target);if(!o.hasClass(n.options.handleClass)){if(o.closest("."+n.options.noDragClass).length){return}o=o.closest("."+n.options.handleClass)}if(!o.length||n.dragEl){return}n.isTouch=/^touch/.test(p.type);if(n.isTouch&&p.touches.length!==1){return}p.preventDefault();n.dragStart(p.touches?p.touches[0]:p)};var m=function(o){if(n.dragEl){o.preventDefault();n.dragMove(o.touches?o.touches[0]:o)}};var l=function(o){if(n.dragEl){o.preventDefault();n.dragStop(o.touches?o.changedTouches[0]:o)}};if(e){n.el[0].addEventListener("touchstart",k,false);c.addEventListener("touchmove",m,false);c.addEventListener("touchend",l,false);c.addEventListener("touchcancel",l,false)}n.el.on("mousedown",k);n.w.on("mousemove",m);n.w.on("mouseup",l);var j=function(){if(e){n.el[0].removeEventListener("touchstart",k,false);c.removeEventListener("touchmove",m,false);c.removeEventListener("touchend",l,false);c.removeEventListener("touchcancel",l,false)}n.el.off("mousedown",k);n.w.off("mousemove",m);n.w.off("mouseup",l);n.el.off("click");n.el.unbind("destroy-nestable");n.el.data("nestable",null)};n.el.bind("destroy-nestable",j)},destroy:function(){this.el.trigger("destroy-nestable")},add:function(k){var j="."+this.options.listClass;var i=f(this.el).children(j);if(k.parent_id!==h){i=i.find('[data-id="'+k.parent_id+'"]');delete k.parent_id;if(i.children(j).length===0){i=i.append(this.options.listRenderer("",this.options))}i=i.find(j+":first");this.setParent(i.parent())}i.append(this._buildItem(k,this.options))},replace:function(j){var i=this._buildItem(j,this.options);this._getItemById(j.id).replaceWith(i)},removeItem:function(m){var l=this.options,j=this.el;m=m||this;m.remove();var k="."+l.listClass+" ."+l.listClass+":not(:has(*))";f(j).find(k).remove();var i='[data-action="expand"], [data-action="collapse"]';f(j).find(i).each(function(){var n=f(this).siblings("."+l.listClass);if(n.length===0){f(this).remove()}})},remove:function(n,o){var j=this.options;var l=this;var i=this._getItemById(n);var k=j.effect.animation||"fade";var m=j.effect.time||"slow";if(k==="fade"){i.fadeOut(m,function(){l.removeItem(i)})}else{this.removeItem(i)}if(o){o()}},removeAll:function(p){var n=this,l=this.options,k=n.el.find(l.listNodeName).first(),j=k.children(l.itemNodeName);var m=l.effect.animation||"fade";var o=l.effect.time||"slow";function i(){j.each(function(){n.removeItem(f(this))});k.show();if(p){p()}}if(m==="fade"){k.fadeOut(o,i)}else{i()}},_getItemById:function(i){return f(this.el).children("."+this.options.listClass).find('[data-id="'+i+'"]')},_build:function(){var i=this.options.json;if(typeof i==="string"){i=JSON.parse(i)}f(this.el).html(this._buildList(i,this.options))},_buildList:function(i,j){if(!i){return""}var k="";var l=this;f.each(i,function(m,n){k+=l._buildItem(n,j)});return j.listRenderer(k,j)},_buildItem:function(q,r){function k(t){var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t+"".replace(/[&<>"']/g,function(u){return s[u]})}function p(t){var u={};for(var s in t){u[t[s]]=t[s]}return u}function i(v,t){var u=v.classes||{};if(typeof u==="string"){u=[u]}var s=p(u);s[t.itemClass]=t.itemClass;return f.map(s,function(w){return w}).join(" ")}function o(s){s=f.extend({},s);delete s.children;delete s.classes;delete s.content;var t={};f.each(s,function(u,v){if(typeof v==="object"){v=JSON.stringify(v)}t["data-"+u]=k(v)});return t}var l=o(q);l["class"]=i(q,r);var n=r.contentCallback(q);var j=this._buildList(q.children,r);var m=f(r.itemRenderer(l,n,j,r,q));this.setParent(m);return m[0].outerHTML},serialize:function(){var k,j=this,i=function(n){var m=[],l=n.children(j.options.itemNodeName);l.each(function(){var o=f(this),r=f.extend({},o.data()),p=o.children(j.options.listNodeName);if(j.options.includeContent){var q=o.find("."+j.options.contentClass).html();if(q){r.content=q}}if(p.length){r.children=i(p)}m.push(r)});return m};k=i(j.el.find(j.options.listNodeName).first());return k},asNestedSet:function(){var m=this,q=m.options,p=-1,j=[],l=1;var i=m.el.find(q.listNodeName).first().children(q.itemNodeName);i.each(function(){l=k(this,p+1,l)});j=j.sort(function(r,o){return(r.lft-o.lft)});return j;function k(r,u,t){var s=t+1,v,o;if(f(r).children(q.listNodeName).children(q.itemNodeName).length>0){u++;f(r).children(q.listNodeName).children(q.itemNodeName).each(function(){s=k(f(this),u,s)});u--}v=f(r).attr("data-id");if(n(v)){v=parseInt(v)}o=f(r).parent(q.listNodeName).parent(q.itemNodeName).attr("data-id")||"";if(n(o)){v=parseInt(o)}if(v){j.push({id:v,parent_id:o,depth:u,lft:t,rgt:s})}t=s+1;return t}function n(o){return f.isNumeric(o)&&Math.floor(o)==o}},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(k){var l=f.extend({},this.options,k),j=[];f(this.element).children(l.items).each(function(){var m=i(this);j.push(m)});return j;function i(n){var o=(f(n).attr(l.attribute||"id")||"").match(l.expression||(/(.+)[-=_](.+)/));if(o){var m={id:o[2]};if(f(n).children(l.listType).children(l.items).length>0){m.children=[];f(n).children(l.listType).children(l.items).each(function(){var p=i(this);m.children.push(p)})}return m}}},toArray:function(){var q=f.extend({},this.options,this),i=q.startDepthCount||0,k=[],n=2,m=this,l=m.el.find(m.options.listNodeName).first();var j=l.children(m.options.itemNodeName);j.each(function(){n=p(f(this),i+1,n)});k=k.sort(function(r,o){return(r.left-o.left)});return k;function p(t,v,u){var s=u+1,w,r;if(t.children(q.options.listNodeName).children(q.options.itemNodeName).length>0){v++;t.children(q.options.listNodeName).children(q.options.itemNodeName).each(function(){s=p(f(this),v,s)});v--}w=t.data().id;if(v===i+1){r=q.rootID}else{var o=(t.parent(q.options.listNodeName).parent(q.options.itemNodeName).data());r=o.id}if(w){k.push({id:w,parent_id:r,depth:v,left:u,right:s})}u=s+1;return u}},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0};this.isTouch=false;this.moving=false;this.dragEl=null;this.dragRootEl=null;this.dragDepth=0;this.hasNewRoot=false;this.pointEl=null},expandItem:function(i){i.removeClass(this.options.collapsedClass)},collapseItem:function(j){var i=j.children(this.options.listNodeName);if(i.length){j.addClass(this.options.collapsedClass)}},expandAll:function(){var i=this;i.el.find(i.options.itemNodeName).each(function(){i.expandItem(f(this))})},collapseAll:function(){var i=this;i.el.find(i.options.itemNodeName).each(function(){i.collapseItem(f(this))})},setParent:function(i){if(i.is(this.options.itemNodeName)&&i.children(this.options.listNodeName).length){i.children("[data-action]").remove();i.prepend(f(this.options.expandBtnHTML));i.prepend(f(this.options.collapseBtnHTML))}},unsetParent:function(i){i.removeClass(this.options.collapsedClass);i.children("[data-action]").remove();i.children(this.options.listNodeName).remove()},dragStart:function(m){var o=this.mouse,n=f(m.target),r=n.closest(this.options.itemNodeName),l={top:m.pageY,left:m.pageX};var q=this.options.onDragStart.call(this,this.el,r,l);if(typeof q!=="undefined"&&q===false){return}this.placeEl.css("height",r.height());o.offsetX=m.pageX-r.offset().left;o.offsetY=m.pageY-r.offset().top;o.startX=o.lastX=m.pageX;o.startY=o.lastY=m.pageY;this.dragRootEl=this.el;this.dragEl=f(a.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass);this.dragEl.css("width",r.outerWidth());this.setIndexOfItem(r);r.after(this.placeEl);r[0].parentNode.removeChild(r[0]);r.appendTo(this.dragEl);f(a.body).append(this.dragEl);this.dragEl.css({left:m.pageX-o.offsetX,top:m.pageY-o.offsetY});var k,j,p=this.dragEl.find(this.options.itemNodeName);for(k=0;k<p.length;k++){j=f(p[k]).parents(this.options.listNodeName).length;if(j>this.dragDepth){this.dragDepth=j}}},createSubLevel:function(i,j){var k=f("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);if(j){k.append(j)}i.append(k);this.setParent(i);return k},setIndexOfItem:function(j,i){i=i||[];i.unshift(j.index());if(f(j[0].parentNode)[0]!==this.dragRootEl[0]){this.setIndexOfItem(f(j[0].parentNode),i)}else{this.dragEl.data("indexOfItem",i)}},restoreItemAtIndex:function(k,l){var p=this.el,q=l.length-1;function o(r,i){if(l[q]===0){f(r).prepend(i.clone(true))}else{f(r.children[l[q]-1]).after(i.clone(true))}}for(var n=0;n<l.length;n++){if(q===parseInt(n)){o(p,k);return}var m=(p[0])?p[0]:p;var j=m.children[l[n]];p=(!j)?this.createSubLevel(f(m)):j}},dragStop:function(n){var i={top:n.pageY,left:n.pageX};var j=this.dragEl.data("indexOfItem");var l=this.dragEl.children(this.options.itemNodeName).first();l[0].parentNode.removeChild(l[0]);this.dragEl.remove();var m=this.options.beforeDragStop.call(this,this.el,l,this.placeEl.parent());if(typeof m!=="undefined"&&m===false){var k=this.placeEl.parent();this.placeEl.remove();if(!k.children().length){this.unsetParent(k.parent())}this.restoreItemAtIndex(l,j);this.reset();return}this.placeEl.replaceWith(l);if(this.hasNewRoot){if(this.options.fixed===true){this.restoreItemAtIndex(l,j)}else{this.el.trigger("lostItem")}this.dragRootEl.trigger("gainedItem")}else{this.dragRootEl.trigger("change")}this.options.callback.call(this,this.dragRootEl,l,i);this.reset()},dragMove:function(q){var r,v,l,o,n,k=this.options,s=this.mouse;this.dragEl.css({left:q.pageX-s.offsetX,top:q.pageY-s.offsetY});s.lastX=s.nowX;s.lastY=s.nowY;s.nowX=q.pageX;s.nowY=q.pageY;s.distX=s.nowX-s.lastX;s.distY=s.nowY-s.lastY;s.lastDirX=s.dirX;s.lastDirY=s.dirY;s.dirX=s.distX===0?0:s.distX>0?1:-1;s.dirY=s.distY===0?0:s.distY>0?1:-1;var j=Math.abs(s.distX)>Math.abs(s.distY)?1:0;if(!s.moving){s.dirAx=j;s.moving=true;return}if(k.scroll){if(typeof c.jQuery.fn.scrollParent!=="undefined"){var i=false;var w=this.el.scrollParent()[0];if(w!==a&&w.tagName!=="HTML"){if((k.scrollTriggers.bottom+w.offsetHeight)-q.pageY<k.scrollSensitivity){w.scrollTop=i=w.scrollTop+k.scrollSpeed}else{if(q.pageY-k.scrollTriggers.top<k.scrollSensitivity){w.scrollTop=i=w.scrollTop-k.scrollSpeed}}if((k.scrollTriggers.right+w.offsetWidth)-q.pageX<k.scrollSensitivity){w.scrollLeft=i=w.scrollLeft+k.scrollSpeed}else{if(q.pageX-k.scrollTriggers.left<k.scrollSensitivity){w.scrollLeft=i=w.scrollLeft-k.scrollSpeed}}}else{if(q.pageY-f(a).scrollTop()<k.scrollSensitivity){i=f(a).scrollTop(f(a).scrollTop()-k.scrollSpeed)}else{if(f(c).height()-(q.pageY-f(a).scrollTop())<k.scrollSensitivity){i=f(a).scrollTop(f(a).scrollTop()+k.scrollSpeed)}}if(q.pageX-f(a).scrollLeft()<k.scrollSensitivity){i=f(a).scrollLeft(f(a).scrollLeft()-k.scrollSpeed)}else{if(f(c).width()-(q.pageX-f(a).scrollLeft())<k.scrollSensitivity){i=f(a).scrollLeft(f(a).scrollLeft()+k.scrollSpeed)}}}}else{console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information")}}if(this.scrollTimer){clearTimeout(this.scrollTimer)}if(k.scroll&&i){this.scrollTimer=setTimeout(function(){f(c).trigger(q)},10)}if(s.dirAx!==j){s.distAxX=0;s.distAxY=0}else{s.distAxX+=Math.abs(s.distX);if(s.dirX!==0&&s.dirX!==s.lastDirX){s.distAxX=0}s.distAxY+=Math.abs(s.distY);if(s.dirY!==0&&s.dirY!==s.lastDirY){s.distAxY=0}}s.dirAx=j;if(s.dirAx&&s.distAxX>=k.threshold){s.distAxX=0;l=this.placeEl.prev(k.itemNodeName);if(s.distX>0&&l.length&&!l.hasClass(k.collapsedClass)&&!l.hasClass(k.noChildrenClass)){r=l.find(k.listNodeName).last();n=this.placeEl.parents(k.listNodeName).length;if(n+this.dragDepth<=k.maxDepth){if(!r.length){this.createSubLevel(l,this.placeEl)}else{r=l.children(k.listNodeName).last();r.append(this.placeEl)}}}if(s.distX<0){o=this.placeEl.next(k.itemNodeName);if(!o.length){v=this.placeEl.parent();this.placeEl.closest(k.itemNodeName).after(this.placeEl);if(!v.children().length){this.unsetParent(v.parent())}}}}var m=false;if(!d){this.dragEl[0].style.visibility="hidden"}this.pointEl=f(a.elementFromPoint(q.pageX-a.body.scrollLeft,q.pageY-(c.pageYOffset||a.documentElement.scrollTop)));if(!d){this.dragEl[0].style.visibility="visible"}if(this.pointEl.hasClass(k.handleClass)){this.pointEl=this.pointEl.closest(k.itemNodeName)}if(this.pointEl.hasClass(k.emptyClass)){m=true}else{if(!this.pointEl.length||!this.pointEl.hasClass(k.itemClass)){return}}var p=this.pointEl.closest("."+k.rootClass),u=this.dragRootEl.data("nestable-id")!==p.data("nestable-id");if(!s.dirAx||u||m){if(u&&k.group!==p.data("nestable-group")){return}if(this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(k.listNodeName).length){return}n=this.dragDepth-1+this.pointEl.parents(k.listNodeName).length;if(n>k.maxDepth){return}var t=q.pageY<(this.pointEl.offset().top+this.pointEl.height()/2);v=this.placeEl.parent();if(m){r=f(a.createElement(k.listNodeName)).addClass(k.listClass);r.append(this.placeEl);this.pointEl.replaceWith(r)}else{if(t){this.pointEl.before(this.placeEl)}else{this.pointEl.after(this.placeEl)}}if(!v.children().length){this.unsetParent(v.parent())}if(!this.dragRootEl.find(k.itemNodeName).length){this.appendEmptyElement(this.dragRootEl)}this.dragRootEl=p;if(u){this.hasNewRoot=this.el[0]!==this.dragRootEl[0]}}},appendEmptyElement:function(i){i.append('<div class="'+this.options.emptyClass+'"/>')}};f.fn.nestable=function(l){var i=this,j=this,k=arguments;if(!("Nestable" in c)){c.Nestable={};Nestable.counter=0}i.each(function(){var n=f(this).data("nestable");if(!n){Nestable.counter++;f(this).data("nestable",new b(this,l));f(this).data("nestable-id",Nestable.counter)}else{if(typeof l==="string"&&typeof n[l]==="function"){if(k.length>1){var o=[];for(var m=1;m<k.length;m++){o.push(k[m])}j=n[l].apply(n,o)}else{j=n[l]()}}}});return j||i}})(window.jQuery||window.Zepto,window,document);